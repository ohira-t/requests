<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="../assets/favicon.svg">
    <title>ユーザー管理 - Requests</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/admin.css">
</head>
<body>
    <div id="admin-app">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-header-left">
                <a href="../app.html" class="admin-back-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                    <span>アプリに戻る</span>
                </a>
                <h1 class="admin-title">ユーザー管理</h1>
            </div>
            <div class="admin-header-right">
                <span class="admin-user-name" id="admin-user-name"></span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Toolbar -->
            <div class="admin-toolbar">
                <div class="admin-toolbar-left">
                    <div class="admin-segment">
                        <button type="button" class="segment-btn active" data-type="staff">社内スタッフ</button>
                        <button type="button" class="segment-btn" data-type="client">クライアント</button>
                    </div>
                    <div class="admin-search">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                        <input type="text" id="user-search" placeholder="名前・メール・会社名で検索...">
                    </div>
                    <select id="department-filter" class="admin-select">
                        <option value="">すべての部署</option>
                    </select>
                </div>
                <div class="admin-toolbar-right">
                    <button class="btn btn-secondary" id="export-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <span>CSVエクスポート</span>
                    </button>
                    <button class="btn btn-secondary" id="import-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <span>CSVインポート</span>
                    </button>
                    <button class="btn btn-primary" id="add-user-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        <span id="add-user-text">スタッフを追加</span>
                    </button>
                </div>
            </div>

            <!-- Stats -->
            <div class="admin-stats" id="admin-stats">
                <div class="stat-item">
                    <span class="stat-value" id="stat-total">0</span>
                    <span class="stat-label">合計</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-admin">0</span>
                    <span class="stat-label">管理者</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-staff">0</span>
                    <span class="stat-label">スタッフ</span>
                </div>
            </div>

            <!-- Table -->
            <div class="admin-table-container">
                <table class="admin-table" id="users-table">
                    <thead>
                        <tr>
                            <th class="col-name">名前</th>
                            <th class="col-email">メールアドレス</th>
                            <th class="col-department">部署</th>
                            <th class="col-role">ロール</th>
                            <th class="col-created">登録日</th>
                            <th class="col-actions">操作</th>
                        </tr>
                    </thead>
                    <tbody id="users-tbody">
                        <!-- Users will be rendered here -->
                    </tbody>
                </table>
                <div class="admin-empty" id="users-empty" style="display: none;">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <p>ユーザーが見つかりません</p>
                </div>
            </div>

            <!-- Pagination -->
            <div class="admin-pagination" id="pagination">
                <button class="pagination-btn" id="prev-page" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                </button>
                <span class="pagination-info" id="pagination-info">1 / 1</span>
                <button class="pagination-btn" id="next-page" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"/>
                    </svg>
                </button>
            </div>
        </main>

        <!-- User Edit Modal -->
        <div id="user-modal" class="modal-overlay" style="display: none;">
            <div class="modal">
                <div class="modal-grabber"></div>
                <div class="modal-header">
                    <h2 class="modal-title" id="user-modal-title">ユーザーを追加</h2>
                    <button class="modal-close" id="user-modal-close">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <form id="user-form" class="modal-body">
                    <input type="hidden" id="user-id">
                    <div class="form-group">
                        <label for="user-name">名前 <span class="required">*</span></label>
                        <input type="text" id="user-name" class="input" placeholder="名前を入力" required>
                    </div>
                    <div class="form-group">
                        <label for="user-email">メールアドレス <span class="required">*</span></label>
                        <input type="email" id="user-email" class="input" placeholder="email@example.com" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="user-role">ロール <span class="required">*</span></label>
                            <select id="user-role" class="input" required>
                                <option value="staff">スタッフ</option>
                                <option value="admin">管理者</option>
                                <option value="client">クライアント</option>
                            </select>
                        </div>
                        <div class="form-group" id="user-department-group">
                            <label for="user-department">部署</label>
                            <select id="user-department" class="input">
                                <option value="">未設定</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="user-company-group" style="display: none;">
                        <label for="user-company">会社名</label>
                        <input type="text" id="user-company" class="input" placeholder="会社名を入力">
                    </div>
                    <div class="form-group">
                        <label for="user-password">パスワード <span class="required" id="password-required">*</span></label>
                        <input type="password" id="user-password" class="input" placeholder="パスワードを入力">
                        <small id="password-hint" style="color: #8e8e93; font-size: 13px;">6文字以上で入力してください</small>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-text-cancel" id="user-modal-delete" style="display: none;">削除</button>
                    <div style="flex: 1;"></div>
                    <button type="button" class="btn btn-secondary" id="user-modal-cancel">キャンセル</button>
                    <button type="submit" form="user-form" class="btn btn-primary">保存</button>
                </div>
            </div>
        </div>

        <!-- Import Modal -->
        <div id="import-modal" class="modal-overlay" style="display: none;">
            <div class="modal">
                <div class="modal-grabber"></div>
                <div class="modal-header">
                    <h2 class="modal-title">CSVインポート</h2>
                    <button class="modal-close" id="import-modal-close">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="import-info">
                        <p>CSVファイルをアップロードしてユーザーを一括登録します。</p>
                        <div class="import-format">
                            <h4>CSVフォーマット:</h4>
                            <code>name,email,password,role,department,company</code>
                            <ul>
                                <li><strong>name</strong>: 名前（必須）</li>
                                <li><strong>email</strong>: メールアドレス（必須）</li>
                                <li><strong>password</strong>: パスワード（必須、6文字以上）</li>
                                <li><strong>role</strong>: admin / staff / client</li>
                                <li><strong>department</strong>: 部署名（社内スタッフのみ）</li>
                                <li><strong>company</strong>: 会社名（クライアントのみ）</li>
                            </ul>
                        </div>
                        <a href="#" class="import-template-link" id="download-template">テンプレートをダウンロード</a>
                    </div>
                    <div class="import-dropzone" id="import-dropzone">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <p>ここにCSVファイルをドロップ</p>
                        <span>または</span>
                        <label class="btn btn-secondary">
                            ファイルを選択
                            <input type="file" id="import-file" accept=".csv" style="display: none;">
                        </label>
                    </div>
                    <div class="import-preview" id="import-preview" style="display: none;">
                        <h4>プレビュー (<span id="preview-count">0</span>件)</h4>
                        <div class="import-preview-table-container">
                            <table class="import-preview-table">
                                <thead>
                                    <tr>
                                        <th>名前</th>
                                        <th>メール</th>
                                        <th>ロール</th>
                                        <th>部署/会社</th>
                                    </tr>
                                </thead>
                                <tbody id="import-preview-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="import-modal-cancel">キャンセル</button>
                    <button type="button" class="btn btn-primary" id="import-execute" disabled>
                        <span class="btn-text">インポート実行</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="spinner"></span>
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast-container"></div>
    </div>
    
    <script src="../assets/js/api.js"></script>
    <script src="../assets/js/admin-users.js"></script>
</body>
</html>
