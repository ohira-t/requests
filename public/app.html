<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Requests">
    <meta name="theme-color" content="#007AFF">
    <link rel="icon" type="image/svg+xml" href="./assets/favicon.svg">
    <link rel="apple-touch-icon" href="./assets/icons/apple-touch-icon.png">
    <link rel="manifest" href="./manifest.json">
    <title>Requests</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body>
    <!-- Loading Screen (Apple-style) -->
    <div id="app-loading" class="app-loading">
        <div class="loading-content">
            <svg class="loading-logo" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="48" height="48" rx="12" fill="url(#loading-logo-gradient)"/>
                <path d="M14 24L21 31L34 18" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <defs>
                    <linearGradient id="loading-logo-gradient" x1="0" y1="0" x2="48" y2="48" gradientUnits="userSpaceOnUse">
                        <stop stop-color="#007AFF" stop-opacity="0.8"/>
                        <stop offset="1" stop-color="#007AFF"/>
                    </linearGradient>
                </defs>
            </svg>
            <div class="loading-spinner">
                <svg viewBox="0 0 50 50">
                    <circle cx="25" cy="25" r="20" fill="none" stroke-width="3"></circle>
                </svg>
            </div>
        </div>
    </div>

    <div id="app" style="display: none;">
        <!-- Login Screen -->
        <div id="login-screen" class="screen">
            <div class="login-container">
                <div class="login-header">
                    <div class="login-logo">
                        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect width="48" height="48" rx="12" fill="url(#logo-gradient)"/>
                            <path d="M14 24L21 31L34 18" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                            <defs>
                                <linearGradient id="logo-gradient" x1="0" y1="0" x2="48" y2="48" gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#007AFF" stop-opacity="0.8"/>
                                    <stop offset="1" stop-color="#007AFF"/>
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <h1 class="login-title">Requests</h1>
                    <p class="login-subtitle">タスク・依頼管理</p>
                </div>
                
                <form id="login-form" class="login-form">
                    <div class="form-group">
                        <label for="email">メールアドレス</label>
                        <input type="email" id="email" name="email" placeholder="email@example.com" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label for="password">パスワード</label>
                        <input type="password" id="password" name="password" placeholder="••••••••" required autocomplete="current-password">
                    </div>
                    <div id="login-error" class="form-error" style="display: none;"></div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <span class="btn-text">ログイン</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="spinner"></span>
                        </span>
                    </button>
                </form>
                
                <div class="login-footer">
                    <button type="button" class="btn-register-link" id="show-register-btn">
                        アカウントをお持ちでない方は<span style="color: var(--color-primary); font-weight: 600;">こちら</span>
                    </button>
                </div>
            </div>
            
            <!-- Register Form -->
            <div class="login-container" id="register-container" style="display: none;">
                <div class="login-header">
                    <div class="login-logo">
                        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect width="48" height="48" rx="12" fill="url(#logo-gradient-register)"/>
                            <path d="M14 24L21 31L34 18" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                            <defs>
                                <linearGradient id="logo-gradient-register" x1="0" y1="0" x2="48" y2="48" gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#007AFF" stop-opacity="0.8"/>
                                    <stop offset="1" stop-color="#007AFF"/>
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <h1 class="login-title">新規登録</h1>
                    <p class="login-subtitle">スタッフアカウントを作成</p>
                </div>
                
                <form id="register-form" class="login-form">
                    <div class="form-group">
                        <label for="register-name">名前 <span class="required">*</span></label>
                        <input type="text" id="register-name" name="name" placeholder="山田太郎" required autocomplete="name">
                    </div>
                    <div class="form-group">
                        <label for="register-email">メールアドレス <span class="required">*</span></label>
                        <input type="email" id="register-email" name="email" placeholder="email@example.com" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label for="register-password">パスワード <span class="required">*</span></label>
                        <input type="password" id="register-password" name="password" placeholder="••••••••" required autocomplete="new-password">
                        <small style="color: #8e8e93; font-size: 13px; margin-top: 4px; display: block;">6文字以上で入力してください</small>
                    </div>
                    <div id="register-error" class="form-error" style="display: none;"></div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <span class="btn-text">登録</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="spinner"></span>
                        </span>
                    </button>
                </form>
                
                <div class="login-footer">
                    <button type="button" class="btn-register-link" id="show-login-btn">
                        既にアカウントをお持ちの方は<span style="color: var(--color-primary); font-weight: 600;">ログイン</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Main App -->
        <div id="main-app" class="screen" style="display: none;">
            <!-- Header -->
            <header class="app-header">
                <div class="header-left">
                    <div class="logo" id="app-logo">
                        <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect width="32" height="32" rx="8" fill="url(#header-logo-gradient)"/>
                            <path d="M9 16L14 21L23 12" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                            <defs>
                                <linearGradient id="header-logo-gradient" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                                    <stop class="logo-stop-1" stop-color="#007AFF" stop-opacity="0.8"/>
                                    <stop class="logo-stop-2" offset="1" stop-color="#007AFF"/>
                                </linearGradient>
                            </defs>
                        </svg>
                        <span class="logo-text">Requests</span>
                    </div>
                </div>
                
                <nav class="view-tabs" id="view-tabs">
                    <button class="view-tab active" data-view="my">
                        <span class="tab-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        </span>
                        <span class="tab-text">自分の課題</span>
                    </button>
                    <button class="view-tab" data-view="requested">
                        <span class="tab-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"/>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                            </svg>
                        </span>
                        <span class="tab-text">依頼した課題</span>
                    </button>
                    <button class="view-tab" data-view="clients">
                        <span class="tab-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/>
                                <path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/>
                                <path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/>
                                <path d="M10 6h4"/>
                                <path d="M10 10h4"/>
                                <path d="M10 14h4"/>
                                <path d="M10 18h4"/>
                            </svg>
                        </span>
                        <span class="tab-text">クライアント別</span>
                    </button>
                    <!-- 統計タブ（管理者のみ表示） -->
                    <button class="view-tab" data-view="stats" id="stats-tab" style="display: none;">
                        <span class="tab-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="20" x2="18" y2="10"/>
                                <line x1="12" y1="20" x2="12" y2="4"/>
                                <line x1="6" y1="20" x2="6" y2="14"/>
                            </svg>
                        </span>
                        <span class="tab-text">統計</span>
                    </button>
                    <button class="view-tab" data-view="calendar" id="calendar-tab">
                        <span class="tab-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                        </span>
                        <span class="tab-text">カレンダー</span>
                    </button>
                </nav>
                
                <div class="header-right">
                    <div class="search-box">
                        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"/>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                        <input type="text" id="search-input" placeholder="タスクを検索...">
                    </div>
                    
                    <button class="btn btn-primary" id="new-task-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        <span>新規タスク</span>
                    </button>
                    
                    <button class="icon-btn notification-btn" id="notifications-btn" title="通知">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                        </svg>
                        <span class="notification-badge" id="notification-badge" style="display: none;">0</span>
                    </button>
                    
                    <button class="icon-btn" id="settings-btn" title="設定">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                    </button>
                    
                    <div class="user-menu" id="user-menu">
                        <button class="user-avatar" id="user-avatar-btn">
                            <span id="user-initials">U</span>
                        </button>
                        <div class="user-dropdown" id="user-dropdown" style="display: none;">
                            <div class="user-info">
                                <span class="user-name" id="user-name">ユーザー</span>
                                <span class="user-email" id="user-email">user@example.com</span>
                            </div>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item" id="change-password-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                </svg>
                                <span>パスワード変更</span>
                            </button>
                            <button class="dropdown-item" id="admin-users-link" style="display: none;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                    <circle cx="9" cy="7" r="4"/>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                </svg>
                                <span>ユーザー管理</span>
                            </button>
                            <button class="dropdown-item" id="export-csv-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                <span>データをエクスポート</span>
                            </button>
                            <div class="dropdown-divider" id="admin-divider" style="display: none;"></div>
                            <button class="dropdown-item text-danger" id="deactivate-account-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                                </svg>
                                <span>アカウントを無効化</span>
                            </button>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item" id="manual-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                                </svg>
                                <span>マニュアル</span>
                            </button>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item" id="logout-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                    <polyline points="16 17 21 12 16 7"/>
                                    <line x1="21" y1="12" x2="9" y2="12"/>
                                </svg>
                                <span>ログアウト</span>
                            </button>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Main Content -->
            <main class="app-main">
                <!-- Sort Controls -->
                <div class="sort-bar" id="sort-bar">
                    <button class="sort-btn" id="sort-btn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="4" y1="6" x2="16" y2="6"/>
                            <line x1="4" y1="12" x2="12" y2="12"/>
                            <line x1="4" y1="18" x2="8" y2="18"/>
                        </svg>
                        <span id="sort-label">期限順</span>
                        <svg class="sort-chevron" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </button>
                    <div class="sort-menu" id="sort-menu">
                        <button class="sort-option active" data-sort="due">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            <span>期限順</span>
                        </button>
                        <button class="sort-option" data-sort="priority">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            <span>優先度順</span>
                        </button>
                        <button class="sort-option" data-sort="created">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            <span>作成日順</span>
                        </button>
                        <button class="sort-option" data-sort="manual">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            <span>手動</span>
                        </button>
                    </div>
                </div>
                
                <div class="board-container" id="board-container">
                    <!-- Columns will be rendered here -->
                </div>
            </main>
        </div>
        
        <!-- Task Modal -->
        <div id="task-modal" class="modal-overlay" style="display: none;">
            <div class="modal">
                <div class="modal-grabber"></div>
                <div class="modal-header">
                    <h2 class="modal-title" id="modal-title">新規タスク</h2>
                    <button class="modal-close" id="modal-close">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                
                <form id="task-form" class="modal-body">
                    <input type="hidden" id="task-id" name="id">
                    
                    <div class="form-group">
                        <label for="task-title">タイトル <span class="required">*</span></label>
                        <input type="text" id="task-title" name="title" placeholder="タスクのタイトルを入力" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="task-description">説明</label>
                        <textarea id="task-description" name="description" rows="3" placeholder="タスクの詳細を入力..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="task-category">カテゴリー</label>
                            <select id="task-category" name="category_id">
                                <option value="">未分類</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <span class="form-label">担当者</span>
                            <input type="hidden" id="task-assignee" name="assignee_id" value="">
                            <button type="button" class="assignee-picker-trigger" id="assignee-trigger">
                                <span class="assignee-display" id="assignee-value">
                                    <span class="assignee-placeholder">担当者を選択</span>
                                </span>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 18 15 12 9 6"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="task-priority">優先度</label>
                            <select id="task-priority" name="priority">
                                <option value="low">低</option>
                                <option value="medium">中</option>
                                <option value="high">高</option>
                                <option value="urgent">緊急</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="task-due-date">期限日</label>
                            <input type="date" id="task-due-date" name="due_date">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="task-tags">タグ（カンマ区切り）</label>
                        <input type="text" id="task-tags" name="tags" placeholder="デザイン, 急ぎ, レビュー待ち">
                    </div>
                </form>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-text-cancel" id="modal-cancel">キャンセル</button>
                    <button type="submit" form="task-form" class="btn btn-primary" id="modal-submit">
                        <span class="btn-text">保存</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="spinner"></span>
                        </span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Task Detail Modal -->
        <div id="task-detail-modal" class="modal-overlay" style="display: none;">
            <div class="modal modal-large">
                <div class="modal-grabber"></div>
                <div class="modal-header">
                    <div class="task-detail-header">
                        <span class="ticket-id" id="detail-ticket-id"></span>
                        <h2 class="modal-title" id="detail-title"></h2>
                    </div>
                    <button class="modal-close" id="detail-close">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                
                <div class="modal-body task-detail-body">
                    <div class="task-detail-main">
                        <div class="task-meta-bar">
                            <span class="task-status-badge" id="detail-status"></span>
                            <span class="task-priority-badge" id="detail-priority"></span>
                            <span class="task-due" id="detail-due"></span>
                        </div>
                        
                        <div class="task-description-box" id="detail-description">
                            <p class="empty-text">説明なし</p>
                        </div>
                        
                        <div class="task-info-grid">
                            <div class="task-info-item">
                                <span class="info-label">カテゴリー</span>
                                <span class="info-value" id="detail-category">-</span>
                            </div>
                            <div class="task-info-item">
                                <span class="info-label">担当者</span>
                                <span class="info-value" id="detail-assignee">-</span>
                            </div>
                            <div class="task-info-item">
                                <span class="info-label">作成者</span>
                                <span class="info-value" id="detail-creator">-</span>
                            </div>
                            <div class="task-info-item">
                                <span class="info-label">作成日</span>
                                <span class="info-value" id="detail-created">-</span>
                            </div>
                        </div>
                        
                        <div class="task-tags-box" id="detail-tags-box" style="display: none;">
                            <span class="info-label">タグ</span>
                            <div class="tag-list" id="detail-tags"></div>
                        </div>
                    </div>
                    
                    <div class="task-comments">
                        <h3 class="comments-title">コメント</h3>
                        <div class="comments-list" id="comments-list">
                            <p class="empty-text">コメントはありません</p>
                        </div>
                        
                        <form class="comment-form" id="comment-form">
                            <textarea id="comment-input" placeholder="コメントを入力..." rows="2"></textarea>
                            <button type="submit" class="btn btn-primary btn-small">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="22" y1="2" x2="11" y2="13"/>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                                </svg>
                                <span>送信</span>
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-text-cancel" id="detail-delete">削除</button>
                    <button type="button" class="btn btn-secondary" id="detail-edit">編集</button>
                    <button type="button" class="btn btn-primary" id="detail-complete">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                        <span id="detail-complete-text">完了にする</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Category Edit Modal -->
        <div id="category-edit-modal" class="modal-overlay" style="display: none;">
            <div class="modal modal-small">
                <div class="modal-grabber"></div>
                <div class="modal-header">
                    <h2 class="modal-title" id="category-edit-title">カテゴリーを編集</h2>
                    <button class="modal-close" id="category-edit-close">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <form id="category-edit-form" class="modal-body">
                    <input type="hidden" id="category-edit-id">
                    <div class="form-group">
                        <label for="category-edit-name">カテゴリー名</label>
                        <input type="text" id="category-edit-name" class="input" placeholder="カテゴリー名を入力" required>
                    </div>
                    <div class="form-group">
                        <label>カラー</label>
                        <div class="color-picker-grid" id="category-color-picker">
                            <button type="button" class="color-option" data-color="#FF3B30" style="background: #FF3B30" title="レッド"></button>
                            <button type="button" class="color-option" data-color="#FF9500" style="background: #FF9500" title="オレンジ"></button>
                            <button type="button" class="color-option" data-color="#FFCC00" style="background: #FFCC00" title="イエロー"></button>
                            <button type="button" class="color-option" data-color="#34C759" style="background: #34C759" title="グリーン"></button>
                            <button type="button" class="color-option" data-color="#00C7BE" style="background: #00C7BE" title="ミント"></button>
                            <button type="button" class="color-option" data-color="#30B0C7" style="background: #30B0C7" title="ティール"></button>
                            <button type="button" class="color-option" data-color="#007AFF" style="background: #007AFF" title="ブルー"></button>
                            <button type="button" class="color-option" data-color="#5856D6" style="background: #5856D6" title="インディゴ"></button>
                            <button type="button" class="color-option" data-color="#AF52DE" style="background: #AF52DE" title="パープル"></button>
                            <button type="button" class="color-option" data-color="#FF2D55" style="background: #FF2D55" title="ピンク"></button>
                            <button type="button" class="color-option" data-color="#A2845E" style="background: #A2845E" title="ブラウン"></button>
                            <button type="button" class="color-option" data-color="#8E8E93" style="background: #8E8E93" title="グレー"></button>
                        </div>
                        <input type="hidden" id="category-edit-color" value="#007AFF">
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="category-edit-cancel">キャンセル</button>
                    <button type="submit" form="category-edit-form" class="btn btn-primary">保存</button>
                </div>
            </div>
        </div>
        
        <!-- Settings Modal -->
        <div id="settings-modal" class="modal-overlay" style="display: none;">
            <div class="modal settings-modal">
                <div class="modal-grabber"></div>
                <div class="modal-header">
                    <h2 class="modal-title">設定</h2>
                    <button class="modal-close" id="settings-close">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Settings Tabs -->
                <div class="settings-tabs" id="settings-tabs">
                    <button class="settings-tab active" data-tab="categories">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                        </svg>
                        <span>カテゴリー</span>
                    </button>
                    <button class="settings-tab" data-tab="departments" id="departments-tab" style="display: none;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <span>部署</span>
                    </button>
                    <button class="settings-tab" data-tab="users" id="users-tab" style="display: none;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <span>ユーザー</span>
                    </button>
                    <button class="settings-tab" data-tab="deactivated" id="deactivated-tab" style="display: none;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                        </svg>
                        <span>無効化済み</span>
                    </button>
                </div>
                
                <div class="modal-body settings-body">
                    <!-- Categories Tab -->
                    <div class="settings-panel active" id="panel-categories">
                        <div class="settings-panel-header">
                            <span class="settings-panel-title">カテゴリー一覧</span>
                            <button class="settings-edit-btn" id="edit-categories-btn">編集</button>
                        </div>
                        <div class="settings-search">
                            <div>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.35-4.35"/>
                                </svg>
                                <input type="text" id="category-search" placeholder="カテゴリーを検索...">
                                <button type="button" class="clear-btn" id="category-search-clear">×</button>
                            </div>
                        </div>
                        <div class="settings-panel-content">
                            <div class="category-list" id="category-list">
                                <!-- Categories will be rendered here -->
                            </div>
                        </div>
                        <div class="settings-panel-footer">
                            <button class="btn btn-secondary btn-full" id="add-category-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                <span>カテゴリーを追加</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Departments Tab -->
                    <div class="settings-panel" id="panel-departments">
                        <div class="settings-panel-header">
                            <span class="settings-panel-title">部署一覧</span>
                            <button class="settings-edit-btn" id="edit-departments-btn">編集</button>
                        </div>
                        <div class="settings-search">
                            <div>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.35-4.35"/>
                                </svg>
                                <input type="text" id="department-search" placeholder="部署を検索...">
                                <button type="button" class="clear-btn" id="department-search-clear">×</button>
                            </div>
                        </div>
                        <div class="settings-panel-content">
                            <div class="department-list" id="department-list">
                                <!-- Departments will be rendered here -->
                            </div>
                        </div>
                        <div class="settings-panel-footer">
                            <button class="btn btn-secondary btn-full" id="add-department-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                <span>部署を追加</span>
                            </button>
                        </div>
                    </div>

                    <!-- Users Tab -->
                    <div class="settings-panel" id="panel-users">
                        <div class="settings-panel-header">
                            <div class="settings-user-segment">
                                <button type="button" class="segment-btn active" data-user-type="staff">社内</button>
                                <button type="button" class="segment-btn" data-user-type="client">クライアント</button>
                            </div>
                            <button class="settings-edit-btn" id="edit-users-btn">編集</button>
                        </div>
                        <div class="settings-search">
                            <div>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.35-4.35"/>
                                </svg>
                                <input type="text" id="user-search" placeholder="ユーザーを検索...">
                                <button type="button" class="clear-btn" id="user-search-clear">×</button>
                            </div>
                        </div>
                        <div class="settings-panel-content">
                            <div class="user-list" id="user-list">
                                <!-- Users will be rendered here -->
                            </div>
                        </div>
                        <div class="settings-panel-footer">
                            <button class="btn btn-secondary btn-full" id="add-user-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                    <circle cx="8.5" cy="7" r="4"/>
                                    <line x1="20" y1="8" x2="20" y2="14"/>
                                    <line x1="23" y1="11" x2="17" y2="11"/>
                                </svg>
                                <span id="add-user-btn-text">ユーザーを追加</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Deactivated Users Tab (Admin Only) -->
                    <div class="settings-panel" id="panel-deactivated">
                        <div class="settings-panel-content">
                            <div class="user-list" id="deactivated-user-list">
                                <!-- Deactivated users will be rendered here -->
                            </div>
                            <div id="deactivated-empty-state" style="display: none; text-align: center; padding: var(--spacing-xl); color: var(--color-text-secondary);">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin: 0 auto 16px; opacity: 0.5;">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                                </svg>
                                <p>無効化されたユーザーはいません</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notifications Panel -->
        <div id="notifications-panel" class="notifications-panel" style="display: none;">
            <div class="notifications-header">
                <h3>通知</h3>
                <div class="notifications-actions">
                    <button class="notifications-action-btn" id="create-announcement-btn" title="お知らせを作成" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                    </button>
                    <button class="notifications-action-btn" id="mark-all-read-btn" title="すべて既読">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                    </button>
                    <button class="notifications-action-btn" id="notifications-close" title="閉じる">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="notifications-list" id="notifications-list">
                <div class="notifications-empty">通知はありません</div>
            </div>
        </div>

        <!-- Change Password Modal -->
        <div id="change-password-modal" class="modal-overlay" style="display: none;">
            <div class="modal modal-small">
                <div class="modal-grabber"></div>
                <div class="modal-header">
                    <h2 class="modal-title">パスワード変更</h2>
                    <button class="modal-close" id="change-password-close">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <form id="change-password-form" class="modal-body">
                    <div class="form-group">
                        <label for="current-password">現在のパスワード <span class="required">*</span></label>
                        <input type="password" id="current-password" class="input" placeholder="現在のパスワードを入力" required autocomplete="current-password">
                    </div>
                    <div class="form-group">
                        <label for="new-password">新しいパスワード <span class="required">*</span></label>
                        <input type="password" id="new-password" class="input" placeholder="新しいパスワードを入力" required autocomplete="new-password">
                        <small style="color: #8e8e93; font-size: 13px;">6文字以上で入力してください</small>
                    </div>
                    <div class="form-group">
                        <label for="new-password-confirmation">新しいパスワード（確認） <span class="required">*</span></label>
                        <input type="password" id="new-password-confirmation" class="input" placeholder="新しいパスワードを再入力" required autocomplete="new-password">
                    </div>
                    <div id="change-password-error" class="form-error" style="display: none;"></div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="change-password-cancel">キャンセル</button>
                    <button type="submit" form="change-password-form" class="btn btn-primary" id="change-password-submit">
                        <span class="btn-text">変更</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="spinner"></span>
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Deactivate Account Modal -->
        <div id="deactivate-account-modal" class="modal-overlay" style="display: none;">
            <div class="modal modal-small">
                <div class="modal-grabber"></div>
                <div class="modal-header">
                    <h2 class="modal-title">アカウントを無効化</h2>
                    <button class="modal-close" id="deactivate-account-close">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <form id="deactivate-account-form" class="modal-body">
                    <div class="alert alert-warning" style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: #fff3cd; border: 1px solid #ffc107; border-radius: var(--radius-md); color: #856404;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="float: left; margin-right: 12px;">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                        <strong>警告:</strong><br>
                        アカウントを無効化すると、自動的にログアウトされ、再ログインできなくなります。<br>
                        <strong>管理者が復元することは可能です。</strong>
                    </div>
                    <div class="form-group">
                        <label for="deactivate-password">パスワードを入力して確認 <span class="required">*</span></label>
                        <input type="password" id="deactivate-password" class="input" placeholder="パスワードを入力" required autocomplete="current-password">
                    </div>
                    <div id="deactivate-account-error" class="form-error" style="display: none;"></div>
                </form>
                <div class="modal-footer" style="display: flex; flex-direction: column-reverse; gap: 8px;">
                    <button type="button" class="btn btn-secondary" id="deactivate-account-cancel" style="width: 100%;">キャンセル</button>
                    <button type="submit" form="deactivate-account-form" class="btn btn-danger" id="deactivate-account-submit" style="width: 100%;">
                        <span class="btn-text">無効化する</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="spinner"></span>
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Manual Modal -->
        <div id="manual-modal" class="modal-overlay" style="display: none;">
            <div class="modal modal-large manual-modal">
                <div class="modal-grabber"></div>
                <div class="modal-header">
                    <h2 class="modal-title">マニュアル</h2>
                    <button class="modal-close" id="manual-close">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="manual-tabs">
                    <button class="manual-tab active" data-tab="quick">クイックスタート</button>
                    <button class="manual-tab" data-tab="guide">機能説明書</button>
                </div>
                <div class="modal-body manual-content">
                    <!-- Quick Start Tab -->
                    <div class="manual-tab-content active" id="manual-quick">
                        <div class="manual-section">
                            <h1>クイックスタートガイド</h1>
                            <p class="manual-subtitle">5分で始めるタスク管理</p>
                        </div>

                        <div class="manual-section">
                            <h2>📱 初めてのログイン</h2>
                            <ol>
                                <li>ブラウザで Requests にアクセス</li>
                                <li><strong>「新規登録」</strong> をタップ</li>
                                <li>名前、メールアドレス、パスワードを入力</li>
                                <li><strong>「登録」</strong> をタップ</li>
                            </ol>
                            <div class="manual-note">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4"/>
                                    <path d="M12 8h.01"/>
                                </svg>
                                サンプルタスクが3つ作成されるので、触ってみましょう！
                            </div>
                        </div>

                        <div class="manual-section">
                            <h2>🎯 基本の3ステップ</h2>
                            
                            <h3>ステップ1: タスクを作る</h3>
                            <div class="manual-flow">
                                <span>右下の「＋」ボタン</span>
                                <span>→</span>
                                <span>タイトルを入力</span>
                                <span>→</span>
                                <span>担当者を選ぶ</span>
                                <span>→</span>
                                <span>「保存」</span>
                            </div>

                            <h3>ステップ2: タスクを確認する</h3>
                            <div class="manual-flow">
                                <span>タスクをタップ</span>
                                <span>→</span>
                                <span>詳細が表示される</span>
                                <span>→</span>
                                <span>必要なら編集</span>
                            </div>

                            <h3>ステップ3: タスクを完了する</h3>
                            <div class="manual-flow">
                                <span>チェックボックスをタップ</span>
                                <span>→</span>
                                <span>「完了する」を選択</span>
                                <span>→</span>
                                <span>完了！</span>
                            </div>
                        </div>

                        <div class="manual-section">
                            <h2>🌟 覚えておきたい機能</h2>
                            
                            <h3>画面下部のメニュー</h3>
                            <table class="manual-table">
                                <thead>
                                    <tr>
                                        <th>アイコン</th>
                                        <th>機能</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>📋 課題</td>
                                        <td>タスク一覧（メイン画面）</td>
                                    </tr>
                                    <tr>
                                        <td>📅 カレンダー</td>
                                        <td>期限を月単位で確認</td>
                                    </tr>
                                    <tr>
                                        <td>📊 統計</td>
                                        <td>タスクの状況を可視化</td>
                                    </tr>
                                    <tr>
                                        <td>⚙️ 設定</td>
                                        <td>カテゴリーやユーザー管理</td>
                                    </tr>
                                </tbody>
                            </table>

                            <h3>優先度の使い分け</h3>
                            <table class="manual-table">
                                <thead>
                                    <tr>
                                        <th>優先度</th>
                                        <th>いつ使う？</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="priority-badge urgent">緊急</span></td>
                                        <td>今日中に終わらせるべきもの</td>
                                    </tr>
                                    <tr>
                                        <td><span class="priority-badge high">高</span></td>
                                        <td>今週中に対応すべきもの</td>
                                    </tr>
                                    <tr>
                                        <td><span class="priority-badge medium">中</span></td>
                                        <td>通常のタスク（デフォルト）</td>
                                    </tr>
                                    <tr>
                                        <td><span class="priority-badge low">低</span></td>
                                        <td>時間があるときにやるもの</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="manual-section">
                            <h2>💡 便利な使い方</h2>
                            
                            <h3>ピン留め機能</h3>
                            <p>よく使う担当者を <strong>スター</strong> でピン留めすると、リストの上に表示されます。</p>

                            <h3>カテゴリーで整理</h3>
                            <p>タスクをプロジェクトやジャンルで分類できます。<br>設定⚙️ → カテゴリー → 「＋カテゴリーを追加」</p>

                            <h3>コメントで会話</h3>
                            <p>タスクについて質問したり、進捗を報告できます。<br>タスクをタップ → 下にスクロール → コメント欄に入力</p>
                        </div>

                        <div class="manual-section">
                            <h2>⚠️ よくある質問</h2>
                            
                            <div class="manual-faq">
                                <h4>Q: 間違えてタスクを完了してしまった！</h4>
                                <p>A: 「完了」タブからタスクをタップして「未完了に戻す」を選択してください。</p>
                            </div>

                            <div class="manual-faq">
                                <h4>Q: 期限を過ぎたタスクはどうなる？</h4>
                                <p>A: 赤色で表示され、「期限切れ」タブに自動的に振り分けられます。</p>
                            </div>

                            <div class="manual-faq">
                                <h4>Q: スマホでもPCでも使える？</h4>
                                <p>A: はい、どのデバイスでも同じデータを共有できます。</p>
                            </div>

                            <div class="manual-faq">
                                <h4>Q: 通知が来ない</h4>
                                <p>A: 画面右上のベルアイコンをタップして、通知一覧を確認してください。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Guide Tab -->
                    <div class="manual-tab-content" id="manual-guide">
                        <div class="manual-section">
                            <h1>Requests - 機能説明書</h1>
                            <p class="manual-subtitle">このアプリについて</p>
                        </div>

                        <div class="manual-section">
                            <h2>📝 できること</h2>
                            <ul>
                                <li>✅ 自分のタスクを管理</li>
                                <li>📤 スタッフ・クライアントへタスクを依頼</li>
                                <li>📊 タスクの進捗状況を可視化</li>
                                <li>📅 カレンダーで期限を確認</li>
                                <li>📱 スマートフォン・タブレット・PCで利用可能</li>
                            </ul>
                        </div>

                        <div class="manual-section">
                            <h2>👥 利用者の種類</h2>
                            
                            <h3>1. 管理者（Admin）</h3>
                            <p><strong>できること:</strong> 全ての機能が使える</p>
                            <ul>
                                <li>ユーザー管理（追加・編集・削除）</li>
                                <li>部署・カテゴリーの管理</li>
                                <li>お知らせの投稿</li>
                                <li>全タスクの閲覧・編集</li>
                                <li>アカウントの無効化</li>
                            </ul>

                            <h3>2. スタッフ（Staff）</h3>
                            <p><strong>できること:</strong></p>
                            <ul>
                                <li>自分のタスク管理</li>
                                <li>他のスタッフ・クライアントへの依頼</li>
                                <li>依頼されたタスクの確認・完了</li>
                                <li>クライアントタスクの管理</li>
                                <li>カテゴリー・部署の閲覧</li>
                            </ul>

                            <h3>3. クライアント（Client）</h3>
                            <p><strong>できること:</strong></p>
                            <ul>
                                <li>自分が依頼したタスクの閲覧</li>
                                <li>タスクの進捗確認</li>
                                <li>コメントでのやり取り</li>
                            </ul>
                        </div>

                        <div class="manual-section">
                            <h2>🎯 主な機能</h2>
                            
                            <h3>1. タスク管理</h3>
                            <p><strong>タスクの作成:</strong></p>
                            <ul>
                                <li>タイトル、説明文を入力</li>
                                <li>担当者を選択（自分/スタッフ/クライアント）</li>
                                <li>優先度を設定（緊急・高・中・低）</li>
                                <li>期限を設定</li>
                                <li>カテゴリーで分類</li>
                            </ul>

                            <p><strong>3つのタブで整理:</strong></p>
                            <table class="manual-table">
                                <thead>
                                    <tr>
                                        <th>タブ</th>
                                        <th>表示内容</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>自分の課題</td>
                                        <td>自分が担当のタスク</td>
                                    </tr>
                                    <tr>
                                        <td>依頼した課題</td>
                                        <td>社内スタッフに依頼したタスク</td>
                                    </tr>
                                    <tr>
                                        <td>クライアント別</td>
                                        <td>クライアントに関連するタスク</td>
                                    </tr>
                                </tbody>
                            </table>

                            <h3>2. カレンダー表示</h3>
                            <ul>
                                <li>月単位でタスクの期限を確認</li>
                                <li>期限が近いタスクを色分け表示</li>
                                <li>自分のタスク: 青</li>
                                <li>依頼したタスク: オレンジ</li>
                                <li>期限切れ: 赤</li>
                            </ul>

                            <h3>3. 統計（ダッシュボード）</h3>
                            <p><strong>3つのカテゴリーで状況を把握:</strong></p>
                            <ol>
                                <li><strong>自分の課題</strong> - 進行中・完了・期限切れの数と完了率</li>
                                <li><strong>依頼した課題</strong> - 依頼中・完了・期限切れの数と完了率</li>
                                <li><strong>クライアント別</strong> - クライアント関連のタスク数と完了率</li>
                            </ol>

                            <h3>4. 設定（管理者・スタッフ）</h3>
                            <ul>
                                <li><strong>カテゴリー管理:</strong> タスクを分類、色分けで視覚的に管理</li>
                                <li><strong>部署管理:</strong> 社内の部署を登録、スタッフを所属</li>
                                <li><strong>ユーザー管理:</strong> スタッフ・クライアントの追加、権限設定</li>
                            </ul>

                            <h3>5. 通知機能</h3>
                            <ul>
                                <li>新しいタスクが割り当てられた</li>
                                <li>タスクにコメントがついた</li>
                                <li>タスクが完了した</li>
                                <li>お知らせが投稿された</li>
                            </ul>

                            <h3>6. コメント機能</h3>
                            <ul>
                                <li>タスクごとに会話</li>
                                <li>進捗状況の共有</li>
                                <li>質問・回答のやり取り</li>
                            </ul>

                            <h3>7. データエクスポート</h3>
                            <ul>
                                <li>タスク一覧をCSVでダウンロード</li>
                                <li>Excelで開いて分析・管理可能</li>
                            </ul>
                        </div>

                        <div class="manual-section">
                            <h2>📊 活用シーン</h2>
                            
                            <h3>社内タスク管理</h3>
                            <ul>
                                <li>各メンバーのタスクを可視化</li>
                                <li>進捗状況を共有</li>
                                <li>期限管理で遅延を防止</li>
                            </ul>

                            <h3>クライアント対応</h3>
                            <ul>
                                <li>クライアントからの依頼を記録</li>
                                <li>対応状況を一目で確認</li>
                                <li>クライアント別に整理</li>
                            </ul>

                            <h3>プロジェクト管理</h3>
                            <ul>
                                <li>カテゴリーでプロジェクトを分類</li>
                                <li>メンバーにタスクを割り当て</li>
                                <li>期限を設定して進行管理</li>
                            </ul>

                            <h3>チーム間の連携</h3>
                            <ul>
                                <li>部署をまたいだ依頼</li>
                                <li>コメントでのコミュニケーション</li>
                                <li>通知で情報共有</li>
                            </ul>
                        </div>

                        <div class="manual-section">
                            <h2>🔒 セキュリティ</h2>
                            <ul>
                                <li>ログイン認証（メールアドレス・パスワード）</li>
                                <li>セッション管理</li>
                                <li>CSRF対策</li>
                                <li>パスワードの暗号化</li>
                                <li>権限による機能制限</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Announcement Modal (Admin Only) -->
        <div id="announcement-modal" class="modal-overlay" style="display: none;">
            <div class="modal modal-small">
                <div class="modal-grabber"></div>
                <div class="modal-header">
                    <h2 class="modal-title">お知らせを作成</h2>
                    <button class="modal-close" id="announcement-close">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <form id="announcement-form" class="modal-body">
                    <div class="form-group">
                        <label for="announcement-title">タイトル <span class="required">*</span></label>
                        <input type="text" id="announcement-title" class="input" placeholder="お知らせのタイトルを入力" required>
                    </div>
                    <div class="form-group">
                        <label for="announcement-message">メッセージ <span class="required">*</span></label>
                        <textarea id="announcement-message" class="input" rows="4" placeholder="お知らせの内容を入力" required style="height: auto; padding: 12px 16px; resize: vertical;"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="announcement-target">配信対象 <span class="required">*</span></label>
                        <select id="announcement-target" class="input" required>
                            <option value="all">全ユーザー</option>
                            <option value="staff">スタッフのみ</option>
                            <option value="clients">クライアントのみ</option>
                        </select>
                    </div>
                    <div id="announcement-error" class="form-error" style="display: none;"></div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="announcement-cancel">キャンセル</button>
                    <button type="submit" form="announcement-form" class="btn btn-primary" id="announcement-submit">
                        <span class="btn-text">送信</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="spinner"></span>
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- User Edit Modal -->
        <div id="user-edit-modal" class="modal-overlay" style="display: none;">
            <div class="modal modal-small">
                <div class="modal-grabber"></div>
                <div class="modal-header">
                    <h2 class="modal-title" id="user-edit-title">ユーザーを編集</h2>
                    <button class="modal-close" id="user-edit-close">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <form id="user-edit-form" class="modal-body">
                    <input type="hidden" id="user-edit-id">
                    <div class="form-group">
                        <label for="user-edit-name">名前 / 会社名 <span class="required">*</span></label>
                        <input type="text" id="user-edit-name" class="input" placeholder="名前を入力" required>
                    </div>
                    <div class="form-group">
                        <label for="user-edit-email">メールアドレス <span class="required">*</span></label>
                        <input type="email" id="user-edit-email" class="input" placeholder="email@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="user-edit-role">ロール <span class="required">*</span></label>
                        <select id="user-edit-role" class="input" required>
                            <option value="staff">スタッフ</option>
                            <option value="admin">管理者</option>
                            <option value="client">クライアント</option>
                        </select>
                    </div>
                    <div class="form-group" id="user-edit-company-group" style="display: none;">
                        <label for="user-edit-company">会社名</label>
                        <input type="text" id="user-edit-company" class="input" placeholder="会社名を入力">
                    </div>
                    <div class="form-group" id="user-edit-department-group">
                        <label for="user-edit-department">部署</label>
                        <select id="user-edit-department" class="input">
                            <option value="">未設定</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="user-edit-password">新しいパスワード</label>
                        <input type="password" id="user-edit-password" class="input" placeholder="変更する場合のみ入力">
                        <small style="color: #8e8e93; font-size: 13px;">空欄の場合は変更されません</small>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="user-edit-cancel">キャンセル</button>
                    <button type="submit" form="user-edit-form" class="btn btn-primary" id="user-edit-submit">
                        <span class="btn-text">保存</span>
                        <span class="btn-loading" style="display: none;">
                            <span class="spinner"></span>
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Assignee Picker Sheet -->
        <div id="assignee-sheet" class="sheet-overlay" style="display: none;">
            <div class="sheet">
                <div class="sheet-header">
                    <button type="button" class="sheet-cancel" id="assignee-sheet-cancel">キャンセル</button>
                    <h3 class="sheet-title">担当者</h3>
                    <button type="button" class="sheet-done" id="assignee-sheet-done">完了</button>
                </div>
                <div class="sheet-search">
                    <div class="sheet-search-box">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                        <input type="text" id="assignee-search" placeholder="検索">
                    </div>
                </div>
                <div class="sheet-segment">
                    <button type="button" class="segment-btn active" data-type="staff">社内</button>
                    <button type="button" class="segment-btn" data-type="client">クライアント</button>
                </div>
                <div class="sheet-list" id="assignee-list">
                    <!-- Users will be rendered here -->
                </div>
                <div class="sheet-footer">
                    <button type="button" class="sheet-add-btn" id="assignee-add-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        <span id="assignee-add-text">スタッフを追加</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast-container"></div>
    </div>
    
    <script src="./assets/js/api.js"></script>
    <script src="./assets/js/app.js"></script>
</body>
</html>
